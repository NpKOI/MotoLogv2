<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MotoLog - Edit Ride</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <style>
    body {
      background: var(--bg-global);
      color: var(--text);
    }
    .form-container {
      background: var(--bg-global);
      min-height: 100vh;
      padding: 20px;
    }
    .form-card {
      background: var(--card-bg);
      border: 1px solid var(--n-300);
      color: var(--text);
      box-shadow: var(--shadow-2);
    }
    .form-card h2 {
      color: var(--primary-600);
    }
    .form-group label {
      color: var(--text);
    }
    .form-group input, .form-group textarea, .form-group select {
      background: var(--n-100);
      border: 1px solid var(--n-300);
      color: var(--text);
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      border-color: var(--primary-500);
    }
    .toggle label {
      color: var(--text);
    }
    .tags-container {
      background: var(--n-100);
      border: 1px solid var(--n-300);
    }
    .tag-section-title {
      color: var(--text);
    }
    .tag-label {
      color: var(--text);
    }
  </style>
</head>
<body>
  <div class="form-container">
    <div class="form-card">
      <h2>âœï¸ Edit Ride</h2>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-messages">
            {% for category, message in messages %}
              <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <form method="POST">
        <div class="form-group">
          <label for="date">Date</label>
          <input type="date" id="date" name="date" value="{{ ride['date'] }}" required>
        </div>

        <div class="form-group">
          <label for="bike_id">Bike (Optional)</label>
          <select id="bike_id" name="bike_id">
            <option value="">-- Select your bike --</option>
            {% for b in bikes %}
              <option value="{{ b['id'] }}" {% if ride['bike_id'] == b['id'] %}selected{% endif %}>{{ b['name'] }} {% if b['make_model'] %}({{ b['make_model'] }}){% endif %}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="distance">Distance (km)</label>
          <input type="number" id="distance" name="distance" step="0.1" value="{{ ride['distance'] }}" required>
        </div>

        <div class="form-group">
          <label for="time">Time (hours)</label>
          <input type="number" id="time" name="time" step="0.1" value="{{ ride['time'] }}" required>
        </div>

        <!-- Tags UI -->
        <div class="tags-container">
          <label class="section-label">ğŸ·ï¸ Ride Tags</label>

          <div class="tag-section">
            <h4 class="tag-section-title">Weather</h4>
            <div class="tags-grid">
              <div>
                <input type="checkbox" id="tag_sunny" class="tag-checkbox" name="tag" value="sunny" {% if 'sunny' in existing_tags %}checked{% endif %}>
                <label for="tag_sunny" class="tag-label">â˜€ï¸ Sunny</label>
              </div>
              <div>
                <input type="checkbox" id="tag_rain" class="tag-checkbox" name="tag" value="rain" {% if 'rain' in existing_tags %}checked{% endif %}>
                <label for="tag_rain" class="tag-label">ğŸŒ§ï¸ Rain</label>
              </div>
              <div>
                <input type="checkbox" id="tag_cloudy" class="tag-checkbox" name="tag" value="cloudy" {% if 'cloudy' in existing_tags %}checked{% endif %}>
                <label for="tag_cloudy" class="tag-label">â˜ï¸ Cloudy</label>
              </div>
              <div>
                <input type="checkbox" id="tag_cold" class="tag-checkbox" name="tag" value="cold" {% if 'cold' in existing_tags %}checked{% endif %}>
                <label for="tag_cold" class="tag-label">â„ï¸ Cold</label>
              </div>
            </div>
          </div>

          <div class="tag-section">
            <h4 class="tag-section-title">Terrain</h4>
            <div class="tags-grid">
              <div>
                <input type="checkbox" id="tag_gravel" class="tag-checkbox" name="tag" value="gravel" {% if 'gravel' in existing_tags %}checked{% endif %}>
                <label for="tag_gravel" class="tag-label">ğŸª¨ Gravel</label>
              </div>
              <div>
                <input type="checkbox" id="tag_offroad" class="tag-checkbox" name="tag" value="offroad" {% if 'offroad' in existing_tags %}checked{% endif %}>
                <label for="tag_offroad" class="tag-label">ğŸœï¸ Offroad</label>
              </div>
              <div>
                <input type="checkbox" id="tag_highway" class="tag-checkbox" name="tag" value="highway" {% if 'highway' in existing_tags %}checked{% endif %}>
                <label for="tag_highway" class="tag-label">ğŸ›£ï¸ Highway</label>
              </div>
              <div>
                <input type="checkbox" id="tag_city" class="tag-checkbox" name="tag" value="city" {% if 'city' in existing_tags %}checked{% endif %}>
                <label for="tag_city" class="tag-label">ğŸ™ï¸ City</label>
              </div>
            </div>
          </div>

          <div class="tag-section">
            <h4 class="tag-section-title">Purpose / Style</h4>
            <div class="tags-grid">
              <div>
                <input type="checkbox" id="tag_commute" class="tag-checkbox" name="tag" value="commute" {% if 'commute' in existing_tags %}checked{% endif %}>
                <label for="tag_commute" class="tag-label">ğŸš— Commute</label>
              </div>
              <div>
                <input type="checkbox" id="tag_tour" class="tag-checkbox" name="tag" value="tour" {% if 'tour' in existing_tags %}checked{% endif %}>
                <label for="tag_tour" class="tag-label">ğŸ—ºï¸ Tour</label>
              </div>
              <div>
                <input type="checkbox" id="tag_sport" class="tag-checkbox" name="tag" value="sport" {% if 'sport' in existing_tags %}checked{% endif %}>
                <label for="tag_sport" class="tag-label">âš¡ Sport</label>
              </div>
              <div>
                <input type="checkbox" id="tag_leisure" class="tag-checkbox" name="tag" value="leisure" {% if 'leisure' in existing_tags %}checked{% endif %}>
                <label for="tag_leisure" class="tag-label">ğŸ˜ Leisure</label>
              </div>
            </div>
          </div>

          <div class="custom-tags">
            <label for="custom_tags" class="field-label">Custom Tags</label>
            <input type="text" id="custom_tags" name="custom_tags" class="custom-tags-input" placeholder="Custom tags, comma separated" value="{{ (ride['tags'] or '') }}">
            <div class="tags-note">ğŸ’¡ Separate multiple custom tags with commas</div>
          </div>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" name="description" rows="3" placeholder="Short notes about your ride...">{{ ride['description'] or '' }}</textarea>
        </div>

        <div class="form-group" style="display:flex; align-items:center; justify-content:space-between; gap:1rem;">
          <div class="toggle">
            <label style="font-weight:600; color:var(--text);">Visibility</label>
            <label class="switch">
              <input type="checkbox" name="is_private" {% if ride['is_private'] %}checked{% endif %}>
              <span class="knob"></span>
            </label>
            <div style="color:var(--muted); font-size:0.9rem;">Toggle to mark private</div>
          </div>
          <div style="text-align:right;">
            <button type="submit" class="btn">Save Changes</button>
          </div>
        </div>

      </form>
    </div>
  </div>

  <script>
    // Theme initialization
    document.addEventListener('DOMContentLoaded', function() {
      // Apply saved theme
      const savedTheme = localStorage.getItem('moto_theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark');
      }
    });
  </script>
</body>
</html>