<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MotoLog - {{ user['username'] }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <style>
    .ride-card-enhanced {
      background: linear-gradient(180deg, var(--card-bg), color-mix(in srgb, var(--card-bg) 96%, var(--glass) 4%));
      border-radius: 14px;
      padding: 18px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-1);
      border-left: 4px solid var(--primary-500);
      transition: all 0.2s ease;
    }
    .ride-card-enhanced:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-2);
    }
    .ride-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 12px;
    }
    .ride-date {
      font-weight: 800;
      color: var(--primary-600);
      font-size: 1.1rem;
    }
    .ride-distance {
      font-weight: 800;
      color: var(--text);
      font-size: 1.2rem;
    }
    .ride-meta {
      color: var(--muted);
      font-size: 0.95rem;
      margin-top: 2px;
    }
    .ride-description {
      color: var(--text);
      margin: 12px 0;
      line-height: 1.5;
      font-size: 0.97rem;
    }
    .ride-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 12px 0;
    }
    .ride-tag {
      background: color-mix(in srgb, var(--primary-500) 6%, transparent);
      color: var(--primary-600);
      padding: 6px 10px;
      border-radius: 6px;
      font-weight: 700;
      font-size: 0.82rem;
    }
    .ride-divider {
      height: 1px;
      background: color-mix(in srgb, var(--muted) 12%, transparent);
      margin: 16px 0;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--n-300);
      margin-bottom: var(--space-lg);
    }
    
    .tab {
      padding: var(--space-md) var(--space-lg);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      color: var(--muted);
      font-weight: 500;
    }
    
    .tab.active {
      color: var(--primary-500);
      border-bottom-color: var(--primary-500);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    {% include '_navbar.html' %}

    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-avatar-large{% if user['profile_pic'] %} {% else %} circle{% endif %}">
        {% if user['profile_pic'] %}
          <a href="/user/{{ user['id'] }}" aria-label="{{ user['username'] }}'s profile">
            <img src="{{ user['profile_pic'] }}" alt="{{ user['username'] }}">
          </a>
        {% else %}
          <a href="/user/{{ user['id'] }}" aria-label="{{ user['username'] }}'s profile" style="display:flex; width:100%; height:100%; align-items:center; justify-content:center; text-decoration:none; color:white; font-weight:800;">
            <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:3rem; background:linear-gradient(135deg,var(--primary-500),var(--primary-600));">
              {{ user['username'][0].upper() }}
            </div>
          </a>
        {% endif %}
      </div>

      <div class="profile-details">
        <h1 class="profile-username">{{ user['username'] }}</h1>

        <div class="profile-stats" style="margin-top:12px;">
          <a href="/user/{{ user['id'] }}" style="text-decoration:none; color:inherit;">
            <div class="stat">
              <div class="stat-value">{{ total_rides }}</div>
              <div class="stat-label">Public Rides</div>
            </div>
          </a>

          <a href="/user/{{ user['id'] }}/followers" style="text-decoration:none; color:inherit;">
            <div class="stat">
              <div class="stat-value">{{ followers|length }}</div>
              <div class="stat-label">Followers</div>
            </div>
          </a>

          <a href="/user/{{ user['id'] }}/following" style="text-decoration:none; color:inherit;">
            <div class="stat">
              <div class="stat-value">{{ following|length }}</div>
              <div class="stat-label">Following</div>
            </div>
          </a>
        </div>

        {% if user['bio'] %}
          <div class="profile-bio" style="margin-top:12px;">{{ user['bio'] }}</div>
        {% endif %}

        <div style="margin-top:10px; color:var(--muted); font-weight:700;">
          üìç {{ user['country'] }}{% if user['city'] %}, {{ user['city'] }}{% endif %}
        </div>

        <div class="action-buttons" style="margin-top:14px;">
          {% if session.get('user_id') and session['user_id'] != user['id'] %}
            <form method="POST" action="/follow/{{ user['id'] }}" style="display:inline;">
              <button class="action-btn follow-btn {% if is_following %}unfollow{% endif %}" type="submit">
                {{ '‚úì Following' if is_following else '+ Follow' }}
              </button>
            </form>
            <a href="/messages/with/{{ user['id'] }}" class="action-btn message-btn">üí¨ Message</a>
          {% endif %}
          <a href="/user/{{ user['id'] }}/garage" class="action-btn garage-btn">üèçÔ∏è Garage</a>
        </div>
      </div>
    </div>

    <!-- Public Rides Section -->
    <div class="profile-section" style="margin-top:28px;">
      <div class="tabs">
        <div class="tab active" onclick="switchTab('rides')">Rides</div>
        <div class="tab" onclick="switchTab('followers')">Followers</div>
        <div class="tab" onclick="switchTab('following')">Following</div>
      </div>
      
      <div id="rides" class="tab-content active">
        <h3 style="margin:0 0 16px 0; color:var(--text);">
          üèçÔ∏è 
          {% if session.get('user_id') and session.get('user_id') == user.id %}
            Recent Rides ({{ rides|length }})
          {% else %}
            Recent Public Rides ({{ rides|length }})
          {% endif %}
        </h3>

      {% if rides %}
        <div style="margin-top:12px;">
          {% for ride in rides %}
            <a href="/ride/{{ ride['id'] }}" style="text-decoration: none; color: inherit;">
              <div class="ride-card-enhanced" style="cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-2)';" onmouseout="this.style.transform='none'; this.style.boxShadow='var(--shadow-1)';">
                <div class="ride-header">
                  <div>
                    <div class="ride-title" style="font-size: 18px; font-weight: bold; color: var(--text); margin-bottom: 4px;">{{ ride['title'] or 'Untitled Ride' }}</div>
                    <div class="ride-date" style="color: var(--muted); font-size: 14px;">üìÖ {{ ride.formatted_date }}</div>
                    {% if ride['description'] %}
                      <div class="ride-meta" style="color: var(--muted); font-size: 14px; margin-top: 4px;">{{ ride['description'] }}</div>
                    {% endif %}
                  </div>
                  <div style="text-align:right;">
                    <div class="ride-distance" style="font-size: 16px; font-weight: bold; color: var(--text);">{{ ride['distance'] }} km</div>
                    <div class="ride-meta" style="color: var(--muted); font-size: 14px;">
                      ‚è±Ô∏è 
                      {% set hours = ride['time'] | int %}
                      {% set minutes = ((ride['time'] - hours) * 60) | round | int %}
                      {% if hours > 0 %}
                        {{ hours }}h{% if minutes > 0 %} {{ minutes }}m{% endif %}
                      {% else %}
                        {{ minutes }}m
                      {% endif %}
                    </div>
                  </div>
                </div>

                {% if ride['tags'] %}
                  <div class="ride-tags">
                    {% set tags = (ride['tags'] or '').split(',') %}
                    {% for tag in tags %}
                      {% set t = tag.strip() %}
                      {% if t %}
                        <div class="ride-tag">{{ t }}</div>
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endif %}
              </div>
            </a>
          {% endfor %}
        </div>
      {% else %}
        <div class="stat-card" style="text-align:center;">
          <div style="font-weight:700; color:var(--muted)">No public rides yet</div>
          <div style="color:var(--muted); margin-top:8px;">This user hasn't shared any public rides.</div>
        </div>
      {% endif %}
      </div>
      
      <div id="followers" class="tab-content">
        <h3 style="margin:0 0 16px 0; color:var(--text);">üë• Followers ({{ followers|length }})</h3>
        {% if followers %}
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px;">
            {% for follower in followers %}
              <a href="/user/{{ follower.id }}" style="text-decoration: none;">
                <div style="background: var(--card-bg); border-radius: 12px; padding: 16px; text-align: center; box-shadow: var(--shadow-1); transition: transform 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)';" onmouseout="this.style.transform='none';">
                  <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">{{ follower.username }}</div>
                  <div style="color: var(--muted); font-size: 14px;">{{ follower.email }}</div>
                </div>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div class="stat-card" style="text-align:center;">
            <div style="font-weight:700; color:var(--muted)">No followers yet</div>
            <div style="color:var(--muted); margin-top:8px;">This user doesn't have any followers.</div>
          </div>
        {% endif %}
      </div>
      
      <div id="following" class="tab-content">
        <h3 style="margin:0 0 16px 0; color:var(--text);">üë§ Following ({{ following|length }})</h3>
        {% if following %}
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px;">
            {% for user_following in following %}
              <a href="/user/{{ user_following.id }}" style="text-decoration: none;">
                <div style="background: var(--card-bg); border-radius: 12px; padding: 16px; text-align: center; box-shadow: var(--shadow-1); transition: transform 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)';" onmouseout="this.style.transform='none';">
                  <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">{{ user_following.username }}</div>
                  <div style="color: var(--muted); font-size: 14px;">{{ user_following.email }}</div>
                </div>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div class="stat-card" style="text-align:center;">
            <div style="font-weight:700; color:var(--muted)">Not following anyone yet</div>
            <div style="color:var(--muted); margin-top:8px;">This user isn't following anyone.</div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  
  <script>
    function switchTab(tabName) {
      // Hide all tab contents
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => content.classList.remove('active'));
      
      // Remove active class from all tabs
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => tab.classList.remove('active'));
      
      // Show selected tab content
      const selectedContent = document.getElementById(tabName);
      if (selectedContent) {
        selectedContent.classList.add('active');
      }
      
      // Add active class to selected tab
      const selectedTab = document.querySelector(`[onclick="switchTab('${tabName}')"]`);
      if (selectedTab) {
        selectedTab.classList.add('active');
      }
    }
    
    // Set default tab to rides
    document.addEventListener('DOMContentLoaded', function() {
      switchTab('rides');
    });
  </script>
</body>
</html>